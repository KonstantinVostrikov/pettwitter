<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Twitter</title>
    <link rel="stylesheet" href="/assets/styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>

<div th:replace="~{header}"></div>


<form class="profile-container" action="#" th:action="@{/users/save-user-profile}"
      enctype="multipart/form-data"
      th:object="${user}" method="post">
    <div th:if="${saved}">
        <h2>Profile Saved</h2>
        <br>
    </div>

    <div class="profile-form-group">
        <label for="username">Username</label>
        <input type="text" id="username" name="username" th:value="${user.username}" readonly/>
    </div>
    <div class="profile-form-group">
        <label for="name">Full Name</label>
        <input type="text" id="name" name="name" th:value="${user.name}" required/>
    </div>

    <div class="profile-photo-container">
        <div class="form-group">
            <label for="image">Image</label>
            <input type="file" id="image" name="image" accept="image/png, image/jpeg"/>
        </div>
        <div>
            <img id="thumbnail" th:src="@{'/'+ ${user.photo}}"  class="profile-thumbnail" alt="User profile image">
        </div>

    </div>
    <button class="profile-safe-button" type="submit">Save</button>
</form>


<script>
    $(document).ready(function () {
        $('#image').change(function () {
            let fileSize = this.files[0].size;
            // check if greater 25 Mb
            if (fileSize > 26214400) {
                alert("File size exceeds 25MB. Please upload a smaller file.")
            } else {
                showImageThumbnail(this);
            }
        });
    });

    function showImageThumbnail(fileInput) {
        let file = fileInput.files[0];
        let reader = new FileReader();
        reader.onload = function (e) {
            $('#thumbnail').attr("src", e.target.result);
        };
        reader.readAsDataURL(file);

    }
</script>

</body>
</html>